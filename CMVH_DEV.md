# ğŸ“§ ColiMail Verification Header (CMVH)

## Blockchain-Based Email Authentication & Incentive Framework

**Version:** 1.0.0  
**Author:** ColiMail Labs (Dao Dreamer)  
**Date:** 2025-11-04  
**License:** MIT

---

## ğŸ§­ Overview

**ColiMail Verification Header (CMVH)** æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼Œç”¨äºå°† **åŒºå—é“¾èº«ä»½éªŒè¯ã€é‚®ä»¶é˜²ä¼ªä¸æ¿€åŠ±æœºåˆ¶** å¼•å…¥ç°æœ‰ç”µå­é‚®ä»¶ä½“ç³»ï¼ˆIMAP/SMTPï¼‰ï¼Œæ— éœ€ä¿®æ”¹æœåŠ¡å™¨ç«¯æˆ–é‚®ä»¶åè®®ã€‚

å®ƒå…è®¸ä»»ä½•é‚®ä»¶å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ ColiMailï¼‰éªŒè¯ï¼š

- é‚®ä»¶å‘é€è€…çš„é“¾ä¸Šèº«ä»½ï¼ˆé’±åŒ…ç­¾å / ENS / åˆçº¦è®¤è¯ï¼‰
- é‚®ä»¶å†…å®¹æ˜¯å¦è¢«ç¯¡æ”¹ï¼ˆå“ˆå¸Œæ¯”å¯¹ï¼‰
- é‚®ä»¶æ˜¯å¦å…·æœ‰å¥–åŠ±æˆ–å¯ä¿¡æ¥æºï¼ˆon-chain proofï¼‰

---

## âœ¨ Key Features

| æ¨¡å— | åŠŸèƒ½è¯´æ˜ | æ˜¯å¦éœ€è¦ColiMailå‘ä»¶æ–¹ |
|------|-----------|----------------|
| ğŸªª é“¾ä¸Šç­¾åéªŒè¯ | éªŒè¯å‘ä»¶äººé’±åŒ…ç­¾åã€ENSæˆ–åˆçº¦èº«ä»½ | âŒ ä¸éœ€è¦ |
| â›“ï¸ é‚®ä»¶å“ˆå¸Œä¸Šé“¾ | å¯é€‰ï¼šå°†é‚®ä»¶å“ˆå¸Œå­˜å‚¨è‡³Arbitrumåˆçº¦ | âœ… å¯é€‰ |
| ğŸ¯ é˜²ä¼ªä¿¡ä»»ç­‰çº§ | UIæ˜¾ç¤º"Verified / On-Chain Verified"çŠ¶æ€ | âŒ ä¸éœ€è¦ |
| ğŸ’° æ¿€åŠ±ç³»ç»Ÿ | ç­¾åé‚®ä»¶å¯æºå¸¦wACTå¥–åŠ±ï¼Œæ”¶ä»¶æ–¹é¢†å– | âœ… å¯é€‰ |
| ğŸ” é™„ä»¶å®Œæ•´æ€§ | å¯æ‰©å±•ï¼šIPFSå“ˆå¸ŒéªŒè¯é™„ä»¶ | âœ… å¯é€‰ |

---

## ğŸ§± Architecture

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Email                 â”‚
â”‚ (Any IMAP/SMTP provider)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ColiMail Client            â”‚
â”‚ (Rust + Tauri + TypeScript)â”‚
â”‚ - Header Parser (CMVH)     â”‚
â”‚ - Signature Verifier       â”‚
â”‚ - Blockchain Verifier      â”‚
â”‚ - Incentive Claim Module   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Blockchain Layer           â”‚
â”‚ (Arbitrum Smart Contract)  â”‚
â”‚ - CMVHVerifier.sol         â”‚
â”‚ - CMVHRewardPool.sol       â”‚
â”‚ - wACT Token Integration   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“œ CMVH Header Specification

æ ¸å¿ƒå¤´å­—æ®µï¼ˆè¯¦ç»†è§„èŒƒè§ [RFC-CMVH-0001](./docs/RFC-CMVH-0001.md)ï¼‰ï¼š

```text
X-CMVH-Version: 1
X-CMVH-Address: 0x53dA9B0a33C6EfE3b26A0B31d8a4eEa2f9E8B9b3
X-CMVH-Chain: Arbitrum
X-CMVH-Timestamp: 1730733600
X-CMVH-HashAlgo: keccak256
X-CMVH-Signature: 0xd54f3b8b9a...ae99
X-CMVH-ENS: alice.eth
X-CMVH-Reward: 0.05 wACT
X-CMVH-ProofURL: ipfs://QmY4H7...
```

---

## ğŸ§© Components Overview

### 1. CMVH-Signer SDK

ç”¨äºå‘ä»¶äººç­¾åç”Ÿæˆï¼Œå¯é›†æˆäºæ’ä»¶ã€ç½‘é¡µæˆ–CLIå·¥å…·ä¸­ã€‚

**è¯­è¨€æ”¯æŒï¼š**

- JavaScript/TypeScript (`@colimail/signer`)
- Rust (for native integration)

**å‡½æ•°ç¤ºä¾‹ï¼š**

```ts
import { signEmail } from "@colimail/signer";

const headers = await signEmail({
  privateKey,
  emailBody,
  from,
  to,
  subject,
});
console.log(headers); // è¾“å‡º X-CMVH-* å¤´å­—æ®µ
```

### 2. CMVH-Verifier Contract (Solidity)

ä½äº `contracts/CMVHVerifier.sol`

```solidity
interface ICMVHVerifier {
  function isValidSignature(
      address signer,
      bytes32 hash,
      bytes calldata sig
  ) external view returns (bool);
}
```

éƒ¨ç½²ç½‘ç»œï¼š

- Arbitrum One ä¸»ç½‘
- Arbitrum Sepolia æµ‹è¯•ç½‘

### 3. ColiMail Client Integration (Tauri + TypeScript)

åœ¨ Rust åç«¯è°ƒç”¨ viem æˆ– ethers-rs éªŒè¯ç­¾åã€‚

å…³é”®æ¨¡å—ï¼š

- `cmvh_parser.ts` â†’ æå–é‚®ä»¶å¤´å¹¶ç”Ÿæˆå“ˆå¸Œ
- `cmvh_verifier.ts` â†’ æ ¡éªŒç­¾åä¸åˆçº¦
- `cmvh_ui.tsx` â†’ UIä¸­æ˜¾ç¤ºéªŒè¯çŠ¶æ€å¾½ç« 

ç¤ºä¾‹ï¼š

```ts
const verified = await verifyCMVH(emailHeaders, emailBody);
if (verified.onchain) showBadge("ğŸ”µ On-Chain Verified");
```

---

## ğŸ§­ Development Plan

### ğŸ¯ Test-Driven Development (TDD) Methodology

æ‰€æœ‰å¼€å‘éµå¾ªç»Ÿä¸€çš„ TDD æ¨¡å¼,ç¡®ä¿ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§:

#### æ ‡å‡†å¼€å‘æµç¨‹

```
1. ğŸ“‹ éœ€æ±‚åˆ†æ
   â””â”€ é˜…è¯»è§„èŒƒæ–‡æ¡£ (MVP_SPEC.md, RFC-CMVH-0001)
   â””â”€ æ˜ç¡®åŠŸèƒ½è¾¹ç•Œå’Œå·²çŸ¥é™åˆ¶
   â””â”€ è¯†åˆ«è¾¹ç•Œæ¡ä»¶å’Œå®‰å…¨è€ƒè™‘

2. âœï¸ ç¼–å†™æµ‹è¯• (Test First)
   â””â”€ å•å…ƒæµ‹è¯•: æ ¸å¿ƒåŠŸèƒ½çš„åŸå­çº§æµ‹è¯•
   â””â”€ é›†æˆæµ‹è¯•: å®Œæ•´æµç¨‹å’ŒçœŸå®åœºæ™¯
   â””â”€ è¾¹ç•Œæµ‹è¯•: Unicodeã€å¤§æ•°æ®ã€ç©ºå€¼ã€ç‰¹æ®Šå­—ç¬¦
   â””â”€ æ€§èƒ½æµ‹è¯•: åŸºå‡†æµ‹è¯• + è‡ªåŠ¨æŠ¥å‘Šç”Ÿæˆ
   â””â”€ é¢„æœŸå¤±è´¥: æµ‹è¯•åº”è¯¥å‘ç°é—®é¢˜,ä¸æ˜¯ä¸ºäº†é€šè¿‡è€Œå†™

3. ğŸ”¨ å®ç°åŠŸèƒ½ (Implementation)
   â””â”€ ç¼–å†™æœ€ç®€å®ç°ä½¿æµ‹è¯•é€šè¿‡
   â””â”€ é‡æ„ä¼˜åŒ–ä»£ç è´¨é‡
   â””â”€ æ·»åŠ ç±»å‹å®šä¹‰å’Œæ–‡æ¡£æ³¨é‡Š

4. ğŸ› æµ‹è¯•é©±åŠ¨è°ƒè¯• (Test-Driven Debugging)
   â””â”€ è¿è¡Œæµ‹è¯•å‘ç°çœŸå®é—®é¢˜
   â””â”€ åˆ†æå¤±è´¥åŸå›  (ä»£ç  bug vs æµ‹è¯•å‡è®¾é”™è¯¯)
   â””â”€ ä¿®å¤ä»£ç  OR ä¿®æ­£æµ‹è¯•å‡è®¾
   â””â”€ è®°å½•å‘ç°çš„è®¾è®¡é—®é¢˜å’Œé™åˆ¶

5. âœ… éªŒè¯å®Œæˆ
   â””â”€ npm test (æ‰€æœ‰æµ‹è¯•é€šè¿‡)
   â””â”€ npm run typecheck (TypeScript ç±»å‹æ£€æŸ¥)
   â””â”€ npm run build (æ„å»ºæˆåŠŸ)
   â””â”€ npm run lint (ä»£ç è´¨é‡æ£€æŸ¥)

6. ğŸ“ æ–‡æ¡£æ›´æ–°
   â””â”€ æ›´æ–° DEVELOPMENT_SUMMARY.md
   â””â”€ ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š (å¦‚é€‚ç”¨)
   â””â”€ æ›´æ–° CMVH_DEV.md Phase çŠ¶æ€
   â””â”€ æ›´æ–°ç›¸å…³ README å’Œ API æ–‡æ¡£
```

#### TDD æœ€ä½³å®è·µ

- âœ… **æµ‹è¯•å…ˆè¡Œ**: å…ˆå†™æµ‹è¯•,åå†™å®ç°
- âœ… **çœŸå®åœºæ™¯**: æ¨¡æ‹Ÿå®é™…ä½¿ç”¨æƒ…å†µ (çœŸå®é‚®ä»¶ã€Unicodeã€å¤§æ–‡ä»¶)
- âœ… **å¤±è´¥ä¼˜å…ˆ**: æµ‹è¯•åº”è¯¥èƒ½å‘ç°é—®é¢˜,ä¸æ˜¯ä¸ºäº†é€šè¿‡è€Œé€šè¿‡
- âœ… **è¾¹ç•Œè¦†ç›–**: ç©ºå€¼ã€æç«¯å€¼ã€ç‰¹æ®Šå­—ç¬¦
- âœ… **æ€§èƒ½ç›‘æ§**: æ¯ä¸ªåŠŸèƒ½éƒ½è¦æœ‰æ€§èƒ½åŸºå‡†
- âœ… **è‡ªåŠ¨åŒ–æŠ¥å‘Š**: æ€§èƒ½æµ‹è¯•è‡ªåŠ¨ç”Ÿæˆ Markdown æŠ¥å‘Š
- âœ… **å‡è®¾éªŒè¯**: æµ‹è¯•å¤±è´¥æ—¶éªŒè¯æ˜¯ä»£ç é—®é¢˜è¿˜æ˜¯æµ‹è¯•å‡è®¾é”™è¯¯

---

### Phase 1 â€” Core RFC & SDK âœ… **COMPLETED** (2025-11-10)

**Status**: ğŸ‰ **MVP COMPLETED - PRODUCTION READY**

#### å·²å®ŒæˆåŠŸèƒ½
- âœ… å®šä¹‰ MVP è§„èŒƒ (`docs/MVP_SPEC.md`)
- âœ… å®ç° TypeScript SDK (`sdk/cmvh-js/`)
  - âœ… é‚®ä»¶ç­¾å (`signEmail`)
  - âœ… ç­¾åéªŒè¯ (`verifyCMVHHeaders`)
  - âœ… é‚®ä»¶è§„èŒƒåŒ– (`canonicalizeEmail`)
  - âœ… å¤´éƒ¨è§£æ (`parseRawHeaders`, `formatCMVHHeaders`)
  - âœ… åŠ å¯†å·¥å…· (keccak256, secp256k1)
  - âœ… TypeScript ç±»å‹å®šä¹‰
  - âœ… è‡ªå®šä¹‰é”™è¯¯ç±»

#### æµ‹è¯•è¦†ç›– (47 tests, 100% passed)
- âœ… å•å…ƒæµ‹è¯• (17 tests)
  - `tests/headers.test.ts`: 8 tests
  - `tests/sign-verify.test.ts`: 9 tests
- âœ… **é›†æˆæµ‹è¯• (19 tests)** - æ–°å¢ 2025-11-10
  - å®Œæ•´é‚®ä»¶æµç¨‹æµ‹è¯•
  - Unicode å’Œç‰¹æ®Šå­—ç¬¦
  - å¤§é‚®ä»¶å¤„ç† (10KB, 100KB)
  - è¾¹ç•Œæƒ…å†µ (ç©ºä¸»é¢˜ã€ç©ºç™½å­—ç¬¦)
  - å®‰å…¨é™åˆ¶éªŒè¯ (é‡æ”¾æ”»å‡»ã€æ—¶é—´æˆ³)
  - è·¨å­—æ®µç¯¡æ”¹æ£€æµ‹
- âœ… **æ€§èƒ½åŸºå‡†æµ‹è¯• (11 tests)** - æ–°å¢ 2025-11-10
  - ç­¾åæ€§èƒ½: 2.5ms (å°é‚®ä»¶), 5.6ms (100KB)
  - éªŒè¯æ€§èƒ½: 1.3ms (å°é‚®ä»¶), 4.5ms (100KB)
  - æ‰¹é‡æ“ä½œ: 1.84ms/å° (ç­¾å), 1.06ms/å° (éªŒè¯)
  - å†…å­˜ä½¿ç”¨: 4.7MB (1000å°é‚®ä»¶)
  - è‡ªåŠ¨ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š

#### æ€§èƒ½è¡¨ç°
| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| å°é‚®ä»¶ç­¾å | <50ms | 2.5ms | âœ… EXCELLENT |
| å°é‚®ä»¶éªŒè¯ | <50ms | 1.3ms | âœ… EXCELLENT |
| å¤§é‚®ä»¶ç­¾å (100KB) | <500ms | 5.6ms | âœ… EXCELLENT |
| å†…å­˜å ç”¨ (1000å°) | <100MB | 4.7MB | âœ… EXCELLENT |

#### å·²çŸ¥é™åˆ¶ (MVPè®¾è®¡å†³ç­–)
- âš ï¸ **æ— é‡æ”¾ä¿æŠ¤**: ç­¾åä¸åŒ…å«æ—¶é—´æˆ³,ç›¸åŒå†…å®¹äº§ç”Ÿç›¸åŒç­¾å
- âš ï¸ **æ— æ—¶é—´æˆ³éªŒè¯**: æ¥å—æœªæ¥/è¿‡å»æ—¶é—´æˆ³
- âš ï¸ **æ— è½¬å‘æ£€æµ‹**: è½¬å‘é‚®ä»¶æ—¶åŸå§‹ç­¾åä¿æŒæœ‰æ•ˆ
- âš ï¸ **ä»… UTF-8**: é UTF-8 å†…å®¹å¯èƒ½å¤±è´¥
- âš ï¸ **æ— é“¾ä¸ŠéªŒè¯**: ä»…æœ¬åœ°éªŒè¯ (Phase 2 å°†å®ç°)

**æ–‡æ¡£**:
- `sdk/cmvh-js/README.md` - API æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
- `sdk/cmvh-js/benchmark-report.md` - æ€§èƒ½åŸºå‡†æŠ¥å‘Š
- `sdk/cmvh-js/DEVELOPMENT_SUMMARY.md` - å¼€å‘æ€»ç»“
- `docs/MVP_SPEC.md` - MVP æŠ€æœ¯è§„èŒƒ
- `docs/GETTING_STARTED.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—

**æ„å»ºäº§ç‰©**:
- âœ… ESM æ ¼å¼ (`dist/index.js`)
- âœ… CJS æ ¼å¼ (`dist/index.cjs`)
- âœ… TypeScript å£°æ˜æ–‡ä»¶ (`dist/index.d.ts`, `dist/index.d.cts`)
- âœ… NPM åŒ…å‡†å¤‡å°±ç»ª (æœªå‘å¸ƒ)

---

### Phase 2 â€” Smart Contract âœ… **COMPLETED** (2025-11-10)

**Status**: ğŸ‰ **PRODUCTION READY**

**å‰ç½®æ¡ä»¶**: âœ… Phase 1 å®Œæˆ

#### å·²å®ŒæˆåŠŸèƒ½
- âœ… åˆå§‹åŒ– Hardhat 3 é¡¹ç›® (æœ€æ–°ç‰ˆæœ¬)
- âœ… å®ç° `CMVHVerifier.sol` åˆçº¦
  - âœ… EIP-191 ç­¾åéªŒè¯ (ECDSA secp256k1)
  - âœ… åœ°å€æ¢å¤å’ŒéªŒè¯
  - âœ… é‚®ä»¶è§„èŒƒåŒ–å’Œå“ˆå¸Œ (ä¸ SDK å®Œå…¨ä¸€è‡´)
  - âœ… æ‰¹é‡éªŒè¯æ”¯æŒ
- âœ… **æµ‹è¯•é©±åŠ¨å¼€å‘** (27 tests, 100% passed)
  - âœ… å•å…ƒæµ‹è¯•: ç­¾åéªŒè¯é€»è¾‘ (18 tests)
  - âœ… é›†æˆæµ‹è¯•: ä¸ SDK ç­¾åäº’æ“ä½œ (7 tests)
  - âœ… Gas ä¼˜åŒ–æµ‹è¯•: **28k gas** (ç›®æ ‡ <100k) âœ¨
  - âœ… è¾¹ç•Œæµ‹è¯•: æ— æ•ˆç­¾åã€é”™è¯¯åœ°å€ã€Unicodeã€å¤§é‚®ä»¶
  - âœ… Solidity æµ‹è¯•: Foundry å…¼å®¹ (3 tests)
- âœ… éƒ¨ç½²è„šæœ¬å’Œ Ignition æ¨¡å—
- âœ… TypeScript + Viem é›†æˆ (æ›¿ä»£ ethers)
- âœ… å®Œæ•´æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

#### æ€§èƒ½è¡¨ç° (è¶…å‡ºé¢„æœŸ)
| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | æå‡å€æ•° |
|------|------|------|---------|
| ç­¾åéªŒè¯ | <100k gas | **28,027 gas** | **3.6x** âš¡âš¡âš¡ |
| å®Œæ•´é‚®ä»¶éªŒè¯ | <150k gas | **31,462 gas** | **4.8x** âš¡âš¡âš¡ |

#### æŠ€æœ¯æ ˆ
- **Hardhat**: 3.0.12 (æœ€æ–°ç‰ˆæœ¬)
- **OpenZeppelin**: 5.4.0
- **Viem**: 2.38.6
- **Solidity**: 0.8.28

#### MVP é™åˆ¶ (Phase 2 è®¾è®¡å†³ç­–)
- âš ï¸ **æ—  EIP-1271**: ä»…æ”¯æŒ EOA (Phase 3 å°†æ·»åŠ )
- âš ï¸ **æ— é‡æ”¾ä¿æŠ¤**: æ—  nonce æœºåˆ¶ (Phase 3 å°†æ·»åŠ )
- âš ï¸ **æ— æ—¶é—´æˆ³éªŒè¯**: ä¸å¼ºåˆ¶ TTL (Phase 3 å°†æ·»åŠ )

**æ–‡æ¡£**:
- `contracts/README.md` - å®Œæ•´åˆçº¦æ–‡æ¡£
- `contracts/PHASE2_SUMMARY.md` - é˜¶æ®µå®Œæˆæ€»ç»“
- `contracts/CMVHVerifier.sol` - å†…è” NatSpec æ–‡æ¡£

**æ„å»ºäº§ç‰©**:
- âœ… CMVHVerifier.sol åˆçº¦ (å·²ç¼–è¯‘)
- âœ… éƒ¨ç½²è„šæœ¬ (`scripts/deploy.ts`)
- âœ… Ignition æ¨¡å— (`ignition/modules/CMVHVerifier.ts`)
- âœ… å®Œæ•´æµ‹è¯•å¥—ä»¶ (27 tests)
- âœ… Arbitrum ç½‘ç»œé…ç½® (Sepolia + One)

---

### Phase 3 â€” Client Integration (é¢„è®¡ 3 weeks) ğŸš§ **NEXT**

**Status**: ğŸ“‹ **READY TO START**

**å‰ç½®æ¡ä»¶**: âœ… Phase 2 å®Œæˆ

- [ ] ColiMail å®¢æˆ·ç«¯å¢åŠ  CMVH æ¨¡å—
- [ ] é‚®ä»¶å¤´è§£æå™¨
- [ ] ç­¾åéªŒè¯é€»è¾‘ (æœ¬åœ° + é“¾ä¸Š)
- [ ] UI çŠ¶æ€å¾½ç« æ˜¾ç¤º
- [ ] è®¾ç½®é€‰é¡¹: "å¯ç”¨åŒºå—é“¾éªŒè¯å±‚"
- [ ] **ç”¨æˆ·ä½“éªŒæµ‹è¯•**
  - [ ] ç­¾åæµç¨‹ <3ç§’
  - [ ] éªŒè¯åé¦ˆå³æ—¶æ˜¾ç¤º
  - [ ] é”™è¯¯æç¤ºæ¸…æ™°æ˜“æ‡‚

---

### Phase 4 â€” Incentive Layer (é¢„è®¡ 3 weeks)

**Status**: â³ **PENDING** (ç­‰å¾… Phase 3)

- [ ] éƒ¨ç½² `CMVHRewardPool.sol`
- [ ] å®ç°å¥–åŠ±åˆ†é…é€»è¾‘
- [ ] ColiMail å®¢æˆ·ç«¯é›†æˆå¥–åŠ±é¢†å–
- [ ] é’±åŒ…è¿æ¥ (WalletConnect)
- [ ] wACT ä»£å¸é›†æˆ
- [ ] **ç»æµæ¨¡å‹æµ‹è¯•**
  - [ ] å¥–åŠ±è®¡ç®—æ­£ç¡®æ€§
  - [ ] Gas æˆæœ¬åˆ†æ
  - [ ] é˜²ä½œå¼Šæœºåˆ¶

---

### Phase 5 â€” Public Beta & Ecosystem (é¢„è®¡ 4 weeks)

**Status**: â³ **PENDING** (ç­‰å¾… Phase 4)

- [ ] æµè§ˆå™¨æ‰©å±• (Gmail/Outlook)
- [ ] Web éªŒè¯é—¨æˆ·
- [ ] å¼€å‘è€…æ–‡æ¡£ ("CMVH for Developers")
- [ ] ç¤ºä¾‹é¡¹ç›®å’Œæ•™ç¨‹
- [ ] **Beta æµ‹è¯•**
  - [ ] 100+ çœŸå®ç”¨æˆ·æµ‹è¯•
  - [ ] æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–
  - [ ] å®‰å…¨å®¡è®¡

---

## ğŸ“ Project Structure

```text
colimail-cmvh/
â”œâ”€â”€ sdk/
â”‚   â””â”€â”€ cmvh-js/                    âœ… Phase 1 å®Œæˆ
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ index.ts            # ä¸»å…¥å£,å¯¼å‡ºæ‰€æœ‰ API
â”‚       â”‚   â”œâ”€â”€ types.ts            # TypeScript ç±»å‹å®šä¹‰
â”‚       â”‚   â”œâ”€â”€ sign.ts             # é‚®ä»¶ç­¾åé€»è¾‘
â”‚       â”‚   â”œâ”€â”€ verify.ts           # ç­¾åéªŒè¯é€»è¾‘
â”‚       â”‚   â”œâ”€â”€ canonicalize.ts     # é‚®ä»¶è§„èŒƒåŒ–
â”‚       â”‚   â”œâ”€â”€ crypto.ts           # åŠ å¯†å·¥å…· (keccak256, secp256k1)
â”‚       â”‚   â”œâ”€â”€ headers.ts          # å¤´éƒ¨è§£æå’Œæ ¼å¼åŒ–
â”‚       â”‚   â””â”€â”€ errors.ts           # è‡ªå®šä¹‰é”™è¯¯ç±»
â”‚       â”œâ”€â”€ tests/
â”‚       â”‚   â”œâ”€â”€ headers.test.ts     # å¤´éƒ¨è§£ææµ‹è¯• (8 tests)
â”‚       â”‚   â”œâ”€â”€ sign-verify.test.ts # ç­¾åéªŒè¯æµ‹è¯• (9 tests)
â”‚       â”‚   â”œâ”€â”€ integration.test.ts # é›†æˆæµ‹è¯• (19 tests) âœ¨
â”‚       â”‚   â””â”€â”€ benchmark.test.ts   # æ€§èƒ½åŸºå‡† (11 tests) âœ¨
â”‚       â”œâ”€â”€ examples/
â”‚       â”‚   â””â”€â”€ basic-usage.ts      # åŸºç¡€ä½¿ç”¨ç¤ºä¾‹
â”‚       â”œâ”€â”€ dist/                   # æ„å»ºè¾“å‡º (ESM + CJS)
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ tsconfig.json
â”‚       â”œâ”€â”€ benchmark-report.md     # è‡ªåŠ¨ç”Ÿæˆçš„æ€§èƒ½æŠ¥å‘Š âœ¨
â”‚       â”œâ”€â”€ DEVELOPMENT_SUMMARY.md  # å¼€å‘æ€»ç»“ âœ¨
â”‚       â””â”€â”€ README.md               # SDK æ–‡æ¡£
â”‚
â”œâ”€â”€ contracts/                      ğŸš§ Phase 2 è®¡åˆ’
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ CMVHVerifier.sol        # ç­¾åéªŒè¯åˆçº¦
â”‚   â”‚   â””â”€â”€ CMVHRewardPool.sol      # å¥–åŠ±æ± åˆçº¦
â”‚   â”œâ”€â”€ test/                       # Foundry æµ‹è¯•
â”‚   â”œâ”€â”€ script/                     # éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ foundry.toml
â”‚
â”œâ”€â”€ client/                         â³ Phase 3-5 è®¡åˆ’
â”‚   â”œâ”€â”€ src-tauri/                  # Tauri åç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ lib/cmvh/               # CMVH å®¢æˆ·ç«¯æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ parser.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ verifier.ts
â”‚   â”‚   â”‚   â””â”€â”€ ui/
â”‚   â”‚   â”‚       â””â”€â”€ CMVHBadge.tsx
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ MVP_SPEC.md                 # MVP æŠ€æœ¯è§„èŒƒ âœ…
â”‚   â”œâ”€â”€ GETTING_STARTED.md          # å¿«é€Ÿå¼€å§‹æŒ‡å— âœ…
â”‚   â””â”€â”€ RFC-CMVH-0001.md            # CMVH åè®®è§„èŒƒ (è®¡åˆ’)
â”‚
â”œâ”€â”€ CMVH_DEV.md                     # æœ¬æ–‡ä»¶ - é¡¹ç›®å¼€å‘æ–‡æ¡£ âœ…
â”œâ”€â”€ CLAUDE.md                       # Claude Code æŒ‡å¯¼æ–‡æ¡£ âœ…
â”œâ”€â”€ LICENSE                         # MIT License
â””â”€â”€ README.md                       # é¡¹ç›®æ€»è§ˆ (å¾…æ›´æ–°)
```

### ä»£ç ç»„ç»‡åŸåˆ™

1. **æ¨¡å—åŒ–**: æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æ¨¡å— (`sign.ts`, `verify.ts`, etc.)
2. **ç±»å‹å®‰å…¨**: æ‰€æœ‰å…¬å…± API éƒ½æœ‰ä¸¥æ ¼çš„ TypeScript ç±»å‹
3. **æµ‹è¯•é©±åŠ¨**: æµ‹è¯•æ–‡ä»¶ä¸æºæ–‡ä»¶ä¸€ä¸€å¯¹åº”
4. **æ–‡æ¡£å®Œæ•´**: æ¯ä¸ªæ¨¡å—éƒ½æœ‰ JSDoc æ³¨é‡Š
5. **æ„å»ºä¼˜åŒ–**: æ”¯æŒ ESM å’Œ CJS åŒæ ¼å¼è¾“å‡º

---

## ğŸ§ª Testing Plan

### Phase 1 - SDK Testing âœ… **COMPLETED**

| æµ‹è¯•æ¨¡å— | æ–¹æ³• | éªŒè¯ç›®æ ‡ | çŠ¶æ€ |
|---------|------|---------|------|
| å•å…ƒæµ‹è¯• | Vitest | ç­¾åä¸€è‡´æ€§ã€å“ˆå¸Œç¨³å®šæ€§ | âœ… 17 tests passed |
| é›†æˆæµ‹è¯• | Vitest | å®Œæ•´é‚®ä»¶æµç¨‹ã€è¾¹ç•Œæƒ…å†µ | âœ… 19 tests passed |
| æ€§èƒ½åŸºå‡† | Vitest + è‡ªå®šä¹‰ | æ€§èƒ½æŒ‡æ ‡ã€å†…å­˜ä½¿ç”¨ | âœ… 11 tests passed |
| ç±»å‹æ£€æŸ¥ | TypeScript | ç±»å‹å®‰å…¨ | âœ… 0 errors |

**æµ‹è¯•è¦†ç›–**: 47/47 tests passed (100%)

### Phase 2 - Smart Contract Testing (è®¡åˆ’ä¸­)

| æµ‹è¯•æ¨¡å— | æ–¹æ³• | éªŒè¯ç›®æ ‡ |
|---------|------|---------|
| åˆçº¦å•å…ƒæµ‹è¯• | Foundry/Forge | ç­¾åéªŒè¯é€»è¾‘ã€æƒé™æ§åˆ¶ |
| Gas åŸºå‡†æµ‹è¯• | Hardhat Gas Reporter | éªŒè¯ <100k gas, éƒ¨ç½²æˆæœ¬ |
| æ¨¡ç³Šæµ‹è¯• | Echidna / Foundry | è¾¹ç•Œæ¡ä»¶ã€æº¢å‡ºæ”»å‡» |
| SDK äº’æ“ä½œæµ‹è¯• | Vitest + viem | SDK ç­¾åä¸åˆçº¦éªŒè¯äº’æ“ä½œ |

### Phase 3 - Client Integration Testing (è®¡åˆ’ä¸­)

| æµ‹è¯•æ¨¡å— | æ–¹æ³• | éªŒè¯ç›®æ ‡ |
|---------|------|---------|
| UI ç»„ä»¶æµ‹è¯• | Vitest + Testing Library | å¾½ç« æ˜¾ç¤ºã€çŠ¶æ€åˆ‡æ¢ |
| E2E æµ‹è¯• | Playwright | ç­¾åâ†’å‘é€â†’æ¥æ”¶â†’éªŒè¯æµç¨‹ |
| æ€§èƒ½æµ‹è¯• | Lighthouse / Custom | ç­¾å<3s, UIå“åº”<100ms |

### Phase 4 - Incentive Layer Testing (è®¡åˆ’ä¸­)

| æµ‹è¯•æ¨¡å— | æ–¹æ³• | éªŒè¯ç›®æ ‡ |
|---------|------|---------|
| å¥–åŠ±é€»è¾‘æµ‹è¯• | Foundry | å¥–åŠ±è®¡ç®—ã€é˜²åŒèŠ± |
| ç»æµæ¨¡å‹æµ‹è¯• | Simulation | ä»£å¸æµåŠ¨ã€æ”»å‡»æˆæœ¬åˆ†æ |

### Phase 5 - Beta Testing (è®¡åˆ’ä¸­)

| æµ‹è¯•æ¨¡å— | æ–¹æ³• | éªŒè¯ç›®æ ‡ |
|---------|------|---------|
| ç”¨æˆ·éªŒæ”¶æµ‹è¯• | çœŸå®ç”¨æˆ· | 100+ ç”¨æˆ·åé¦ˆ |
| è´Ÿè½½æµ‹è¯• | K6 / Artillery | å¹¶å‘ç­¾å/éªŒè¯ |
| å®‰å…¨å®¡è®¡ | ç¬¬ä¸‰æ–¹å®¡è®¡ | æ™ºèƒ½åˆçº¦å®‰å…¨ |

---

## ğŸ’¡ Example Use Case

ä¸€å°å¸¦æœ‰é“¾ä¸Šç­¾åçš„é‚®ä»¶ï¼š

```text
From: alice@gmail.com
To: bob@outlook.com
Subject: Partnership Proposal
X-CMVH-Address: 0x53dA9B...
X-CMVH-Signature: 0xfda391...
X-CMVH-ENS: alice.eth
X-CMVH-Reward: 0.05 wACT
```

ColiMail å®¢æˆ·ç«¯è§£æåï¼š

- è‡ªåŠ¨éªŒè¯ç­¾å
- æŸ¥è¯¢ ENS â†’ æ˜¾ç¤º "âœ… alice.eth verified"
- è¯†åˆ«å¥–åŠ±å­—æ®µ â†’ æç¤º "ğŸ’° é¢†å– 0.05 wACT"

---

## ğŸ› ï¸ Tech Stack

| å±‚ | æŠ€æœ¯ | è¯´æ˜ |
|---|------|-----|
| å®¢æˆ·ç«¯ | Rust + Tauri + TypeScript + React | ColiMail æ¡Œé¢åº”ç”¨ |
| åˆçº¦ | Solidity 0.8.28 + Hardhat Ignition | Arbitrumä¸»ç½‘éªŒè¯é€»è¾‘ |
| SDK | TypeScript + Rust | ç­¾åä¸éªŒè¯å·¥å…· |
| å‰ç«¯Webæ¼”ç¤º | Next.js / Astro | é‚®ä»¶éªŒè¯é—¨æˆ· |
| é’±åŒ…æ¥å£ | viem + WalletConnect | ç”¨æˆ·é’±åŒ…äº¤äº’ |

---

## ğŸ”® Future Extensions

| æ¨¡å— | åŠŸèƒ½æè¿° |
|-----|---------|
| **CMVH-Encrypt** | é‚®ä»¶å†…å®¹åŠ å¯†ï¼Œä½¿ç”¨é’±åŒ…å…¬é’¥æ´¾ç”ŸAESå¯†é’¥ |
| **CMVH-Attach** | é™„ä»¶å®Œæ•´æ€§éªŒè¯ï¼ˆIPFSå“ˆå¸Œï¼‰ |
| **CMVH-Relay** | å»ä¸­å¿ƒåŒ–æ—¶é—´æˆ³è¯æ˜ |
| **ColiMail ENS Bridge** | å°†é‚®ç®±ç»‘å®š ENS åç§° |
| **AI Spam Shield** | åˆ©ç”¨ç­¾åéªŒè¯ + AI è¯†åˆ«ä¼˜å…ˆçº§æŠ•é€’ |

---

## ğŸ¤ Governance & Open Source

CMVH æ ‡å‡†åŠç›¸å…³å®ç°ç”± ColiMail Foundation ç»´æŠ¤ï¼Œé‡‡ç”¨å¼€æ”¾æ”¹è¿›ææ¡ˆæµç¨‹ï¼ˆCIP: ColiMail Improvement Proposalï¼‰ã€‚

ç¤¾åŒºå¯æäº¤ï¼š

- æ–°å¢Headerå­—æ®µ
- æ–°åˆçº¦æ‰©å±•æ¨¡å—
- å®‰å…¨å»ºè®®ä¸ä¼˜åŒ–æ–¹æ¡ˆ

æ‰€æœ‰ç»„ä»¶å‡åŸºäº MIT License å‘å¸ƒã€‚

---

## ğŸ—ºï¸ Roadmap Summary

| é˜¶æ®µ | è®¡åˆ’æ—¶é—´ | å®é™…æ—¶é—´ | çŠ¶æ€ | å…³é”®äº¤ä»˜ç‰© |
|-----|---------|---------|------|-----------|
| **Phase 1** | 2025 Q4 | âœ… 2025-11-10 | âœ… **å®Œæˆ** | SDK MVP + 47 æµ‹è¯• + æ€§èƒ½æŠ¥å‘Š |
| Phase 2 | 2026 Q1 | - | ğŸ“‹ å‡†å¤‡ä¸­ | Verifier åˆçº¦ + æµ‹è¯•å¥—ä»¶ |
| Phase 3 | 2026 Q1-Q2 | - | â³ ç­‰å¾… | å®¢æˆ·ç«¯é›†æˆ + UI ç»„ä»¶ |
| Phase 4 | 2026 Q2 | - | â³ ç­‰å¾… | å¥–åŠ±æ± åˆçº¦ + é’±åŒ…é›†æˆ |
| Phase 5 | 2026 Q3 | - | â³ ç­‰å¾… | æµè§ˆå™¨æ‰©å±• + å¼€å‘è€…ç”Ÿæ€ |

---

## ğŸ¯ Project Milestones & Achievements

### ğŸ† Phase 1 å®Œæˆ (2025-11-10)

**å…³é”®æˆå°±**:
- âœ… **MVP åŠŸèƒ½ 100% å®Œæˆ**: ç­¾åã€éªŒè¯ã€è§£æã€æ ¼å¼åŒ–
- âœ… **æµ‹è¯•è¦†ç›– 100%**: 47/47 tests passed
- âœ… **æ€§èƒ½è¶…é¢„æœŸ**: ç­¾å 2.5ms, éªŒè¯ 1.3ms (ç›®æ ‡ <50ms)
- âœ… **å†…å­˜é«˜æ•ˆ**: 1000å°é‚®ä»¶ä»… 4.7MB (ç›®æ ‡ <100MB)
- âœ… **TDD æ–¹æ³•è®ºç¡®ç«‹**: æµ‹è¯•é©±åŠ¨å‘ç°3ä¸ªçœŸå®é—®é¢˜å¹¶ä¿®å¤
- âœ… **è‡ªåŠ¨åŒ–æŠ¥å‘Š**: æ€§èƒ½åŸºå‡†è‡ªåŠ¨ç”Ÿæˆ Markdown æŠ¥å‘Š

**å…³é”®æŒ‡æ ‡**:
```
ä»£ç è¡Œæ•°: ~1,200 lines (src/)
æµ‹è¯•è¡Œæ•°: ~2,500 lines (tests/)
æµ‹è¯•/ä»£ç æ¯”: 2.08:1
æ€§èƒ½æå‡: 20x faster than target
å†…å­˜ä¼˜åŒ–: 21x better than target
```

**æŠ€æœ¯æ ˆéªŒè¯**:
- âœ… TypeScript + Vitest (æµ‹è¯•æ¡†æ¶)
- âœ… @noble/secp256k1 (åŠ å¯†åº“)
- âœ… viem (ä»¥å¤ªåŠå·¥å…·)
- âœ… tsup (æ„å»ºå·¥å…·)

**æ–‡æ¡£äº§å‡º**:
- ğŸ“„ `MVP_SPEC.md` - æŠ€æœ¯è§„èŒƒ
- ğŸ“„ `GETTING_STARTED.md` - å¿«é€Ÿå¼€å§‹
- ğŸ“„ `benchmark-report.md` - æ€§èƒ½æŠ¥å‘Š
- ğŸ“„ `DEVELOPMENT_SUMMARY.md` - å¼€å‘æ€»ç»“
- ğŸ“„ `sdk/cmvh-js/README.md` - API æ–‡æ¡£
- ğŸ“„ `CLAUDE.md` - AI å¼€å‘æŒ‡å—

---

## ğŸ“Š Key Metrics Dashboard

### å¼€å‘æ•ˆç‡æŒ‡æ ‡
- **MVP å¼€å‘å‘¨æœŸ**: Phase 1 å®Œæˆç”¨æ—¶ <1 week
- **Bug å‘ç°ç‡**: 3ä¸ªçœŸå®é—®é¢˜ (æµ‹è¯•é©±åŠ¨å‘ç°)
- **Bug ä¿®å¤ç‡**: 100% (æ‰€æœ‰é—®é¢˜å·²è§£å†³)
- **æ–‡æ¡£è¦†ç›–ç‡**: 100% (æ‰€æœ‰å…¬å…± API æœ‰æ–‡æ¡£)

### è´¨é‡æŒ‡æ ‡
- **æµ‹è¯•é€šè¿‡ç‡**: 100% (47/47)
- **ç±»å‹å®‰å…¨**: 0 TypeScript errors
- **ä»£ç è§„èŒƒ**: 0 ESLint warnings
- **æ„å»ºæˆåŠŸç‡**: 100%

### æ€§èƒ½æŒ‡æ ‡ (vs ç›®æ ‡)
| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | æå‡å€æ•° |
|------|------|------|---------|
| å°é‚®ä»¶ç­¾å | <50ms | 2.5ms | 20x âš¡ |
| å°é‚®ä»¶éªŒè¯ | <50ms | 1.3ms | 38x âš¡âš¡ |
| å¤§é‚®ä»¶ç­¾å | <500ms | 5.6ms | 89x âš¡âš¡âš¡ |
| å†…å­˜å ç”¨ | <100MB | 4.7MB | 21x ğŸ’¾ |

### æµ‹è¯•è¦†ç›–æŒ‡æ ‡
- **å•å…ƒæµ‹è¯•**: 17 tests (æ ¸å¿ƒåŠŸèƒ½)
- **é›†æˆæµ‹è¯•**: 19 tests (çœŸå®åœºæ™¯)
- **æ€§èƒ½æµ‹è¯•**: 11 benchmarks (è‡ªåŠ¨æŠ¥å‘Š)
- **è¾¹ç•Œæµ‹è¯•**: âœ… Unicode, å¤§æ–‡ä»¶, ç©ºå€¼, ç‰¹æ®Šå­—ç¬¦

---

## ğŸš€ Next Actions

### ç«‹å³å¯æ‰§è¡Œ
1. **NPM å‘å¸ƒå‡†å¤‡**
   - [ ] æ›´æ–° package.json ç‰ˆæœ¬åˆ° 1.0.0
   - [ ] æ·»åŠ  .npmignore
   - [ ] å‡†å¤‡å‘å¸ƒè¯´æ˜
   - [ ] `npm publish --dry-run` é¢„å‘å¸ƒæµ‹è¯•

2. **Phase 2 å¯åŠ¨å‡†å¤‡**
   - [ ] åˆå§‹åŒ– Foundry é¡¹ç›® (`forge init contracts/`)
   - [ ] ç¼–å†™ Phase 2 æµ‹è¯•ç”¨ä¾‹ (Test First)
   - [ ] ç ”ç©¶ EIP-191/EIP-1271 æ ‡å‡†

### çŸ­æœŸç›®æ ‡ (1-2 å‘¨)
- [ ] å®ç° `CMVHVerifier.sol` åŸºç¡€åˆçº¦
- [ ] ç¼–å†™åˆçº¦å•å…ƒæµ‹è¯•
- [ ] SDK ä¸åˆçº¦äº’æ“ä½œæµ‹è¯•
- [ ] Gas ä¼˜åŒ–åŸºå‡†æµ‹è¯•

---

## ğŸ§© Vision Statement

> "ColiMail brings blockchain trust to everyday communication."

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ‰“é€ æ–°ä¸€ä»£ä¿¡ä»»é‚®ä»¶ç”Ÿæ€ç³»ç»Ÿï¼š

- âœ… æ— éœ€è‡ªå»ºæœåŠ¡å™¨ (Phase 1 å·²å®ç°)
- âœ… å…¼å®¹æ‰€æœ‰é‚®ç®± (Phase 1 å·²å®ç°)
- ğŸš§ æ”¯æŒé“¾ä¸Šç­¾åéªŒè¯ (Phase 2 è¿›è¡Œä¸­)
- â³ æ¿€åŠ±å®‰å…¨é€šä¿¡ä¸çœŸå®èº«ä»½ (Phase 4 è§„åˆ’)
